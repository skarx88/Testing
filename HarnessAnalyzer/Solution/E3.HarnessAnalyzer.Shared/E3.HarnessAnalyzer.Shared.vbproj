<Project Sdk="Microsoft.NET.Sdk">

	<PropertyGroup Label="PROJECT">
		<ProjectGuid>{34E0F496-A2C0-457A-B202-C484F0088F32}</ProjectGuid>
	</PropertyGroup>

	<PropertyGroup Label="ASSEMBLY">
		<TargetFrameworks>net472;$(ProductTargetFramework)</TargetFrameworks>
		<RootNamespace>Zuken.E3.HarnessAnalyzer.Shared</RootNamespace>
		<Platforms>x64</Platforms>
		<AllowedOutputExtensionsInPackageBuildOutputFolder>$(AllowedOutputExtensionsInPackageBuildOutputFolder);.pdb</AllowedOutputExtensionsInPackageBuildOutputFolder>
		<AssemblySearchPaths>$(AssemblySearchPaths);{GAC}</AssemblySearchPaths>
		<OptionInfer>Off</OptionInfer>
		<OptionExplicit>On</OptionExplicit>
		<OptionStrict>On</OptionStrict>
		<OptionCompare>Binary</OptionCompare>
		<Configurations>Debug;Release;Debug_MFC</Configurations>
		<GenerateResourceUsePreserializedResources>true</GenerateResourceUsePreserializedResources>
	</PropertyGroup>

	<PropertyGroup Label="ASSEMBLY_WINDOWS" Condition="$(TargetFramework.Contains('windows')) Or $(TargetFramework.StartsWith('net4'))">
		<UseWindowsForms>true</UseWindowsForms>
	</PropertyGroup>

	<PropertyGroup Label="META_DATA">
		<PackageId>E3.HarnessAnalyzer.Shared</PackageId>
		<!--================================-->
		<!-- Additional Meta Data was moved to Directory.build.props -->
		<!--================================-->
		<IncludeSourceRevisionInInformationalVersion>false</IncludeSourceRevisionInInformationalVersion> <!-- see also: https://github.com/dotnet/sdk/issues/18294 -->
		<Description>EÂ³Harnessanalyzer library for shared objects</Description>
		<PackageTags>Erlangen</PackageTags>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|x64'">
		<DebugType>none</DebugType>
		<DebugSymbols>false</DebugSymbols>
		<DefineDebug>false</DefineDebug>
		<DefineTrace>true</DefineTrace>
		<DocumentationFile>E3.HarnessAnalyzer.Shared.xml</DocumentationFile>
		<OutputPath>bin\</OutputPath>
		<PlatformTarget>x64</PlatformTarget>
		<Optimize>true</Optimize>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|x64'">
		<DebugType>full</DebugType>
		<DebugSymbols>true</DebugSymbols>
		<DefineDebug>true</DefineDebug>
		<DefineTrace>true</DefineTrace>
		<DocumentationFile>E3.HarnessAnalyzer.Shared.xml</DocumentationFile>
		<OutputPath>bin\</OutputPath>
		<PlatformTarget>x64</PlatformTarget>
		<RunAnalyzersDuringBuild>false</RunAnalyzersDuringBuild>
	</PropertyGroup>

	<PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug_MFC|x64'">
		<DebugType>full</DebugType>
		<DebugSymbols>true</DebugSymbols>
		<DefineDebug>true</DefineDebug>
		<DefineTrace>true</DefineTrace>
		<DocumentationFile>E3.HarnessAnalyzer.Shared.xml</DocumentationFile>
		<OutputPath>bin\</OutputPath>
		<PlatformTarget>x64</PlatformTarget>
		<RunAnalyzersDuringBuild>false</RunAnalyzersDuringBuild>
	</PropertyGroup>

	<Choose>
		<When Condition="$(Configuration.StartsWith('Release'))">
			<ItemGroup Label="RELEASE_REFERENCES">
				<PackageReference Include="E3.Lib.Converter.Unit" Version="1.0.0-beta.5" />
				<PackageReference Include="E3.Lib.Shared" Version="1.0.0-beta.7" />
				<PackageReference Include="E3.Lib.DotNet.Expansions.Windows" Version="1.0.0-beta.14" Condition="$(TargetFramework.Contains('windows')) OR $(TargetFramework.StartsWith('net4'))" />
			</ItemGroup>
		</When>
		<Otherwise>
			<ItemGroup Label="DEBUG_REFERENCES">
				<ProjectReference Include="$(MSBuildProjectDirectory)\..\..\..\..\E3.Lib\DotNet.Expansions\Solution\E3.Lib.DotNet.Expansions.vbproj" />
				<ProjectReference Include="$(MSBuildProjectDirectory)\..\..\..\..\E3.Lib\DotNet.Expansions.Windows\Solution\E3.Lib.DotNet.Expansions.Windows.vbproj" />
				<ProjectReference Include="$(MSBuildProjectDirectory)\..\..\..\..\E3.Lib\Converter.Unit\Solution\E3.Lib.Converter.Unit.vbproj" />
				<ProjectReference Include="$(MSBuildProjectDirectory)\..\..\..\..\E3.Lib\Shared\Solution\E3.Lib.Shared.vbproj" />
			</ItemGroup>
			<ItemGroup Label="CPP_MFC_DEBUG_EXTRA_REFERENCES" Condition="$(Configuration.Contains('MFC'))">
				<ProjectReference Include="$(MSBuildProjectDirectory)\..\..\..\..\E3.Lib\Licensing\Solution\E3.Lib.Licensing.vbproj" Condition="$(TargetFramework.Contains('windows')) OR $(TargetFramework.StartsWith('net4'))" />
				<ProjectReference Include="$(MSBuildProjectDirectory)\..\..\..\..\E3.Lib\Licensing\Solution\FlexLmWrapper\NET4\E3.Lib.Licensing.Wrapper.MFC.NET4.vcxproj" Condition="$(TargetFramework.StartsWith('net4'))" />
				<ProjectReference Include="$(MSBuildProjectDirectory)\..\..\..\..\E3.Lib\Licensing\Solution\FlexLmWrapper\NET6\E3.Lib.Licensing.Wrapper.MFC.NET6.vcxproj" Condition="$(TargetFramework.StartsWith('net6')) And $(TargetFramework.Contains('windows'))" />
				<ProjectReference Include="$(MSBuildProjectDirectory)\..\..\..\..\E3.Lib\Licensing\Solution\FlexLmWrapper\NET8\E3.Lib.Licensing.Wrapper.MFC.NET8.vcxproj" Condition="$(TargetFramework.StartsWith('net8')) And $(TargetFramework.Contains('windows'))" />
			</ItemGroup>
		</Otherwise>
	</Choose>

	<Choose>
		<When Condition="$(TargetFramework.StartsWith('net4'))">
			<ItemGroup Label="NET4_COMMON_REFERENCES">
				<Reference Include="System.IO.Compression" />
			</ItemGroup>
		</When>
		<Otherwise>
			<ItemGroup Condition="!$(TargetFramework.Contains('windows'))">
				<Compile Remove="LicenseManager.vb" />
			</ItemGroup>
			<ItemGroup Label="NET_CORE_COMMON_REFERENCES">
				<PackageReference Include="System.IO.Compression" Version="4.3.0" />
			</ItemGroup>
		</Otherwise>
	</Choose>

	<ItemGroup Label="COMMON_WINDOWS_TARGET_REFERENCES" Condition="$(TargetFramework.Contains('windows')) OR $(TargetFramework.StartsWith('net4'))">
		<PackageReference Include="E3.Lib.Licensing" Version="1.0.0-beta.6" Condition="($(Configuration.StartsWith('Release')) Or !$(Configuration.Contains('MFC'))) And ($(TargetFramework.Contains('windows')) Or $(TargetFramework.StartsWith('net4')))" />
		<PackageReference Include="System.Drawing.Common" Version="8.0.2" />
	</ItemGroup>

	<ItemGroup Label="COMMON_REFERENCES">
	  <PackageReference Include="System.Resources.Extensions" Version="8.0.0" />
	</ItemGroup>

	<Target Name="WriteSetupZstartContents" AfterTargets="CustomSignMsiTask" Condition="$(Configuration.StartsWith('Release'))">
		<WriteLinesToFile File="$(ZstartBatchFilePath)" Lines="$(ZstartBatchFileContent)" Overwrite="true" WriteOnlyWhenDifferent="true" />
		<WriteLinesToFile File="$(ZstartRunJsonFilePath)" Lines="$(ZstartRunJsonContent)" Overwrite="true" WriteOnlyWhenDifferent="true" />
		<WriteLinesToFile File="$(ZstartVersionInfoFilePath)" Lines="$(ZStart_Version_Info_Json)" Overwrite="true" Encoding="ASCII" />
		<MakeDir Directories="$(SandboxOutputPath)" />
		<MakeDir Directories="$(PackagesOutputPath)" />
		<Exec Command="copy &quot;..\..\$(PackagesFolderName)\*.*&quot; &quot;$(PackagesOutputPath)&quot;" />
		<Exec Command="powershell -Command &quot;Invoke-WebRequest -OutFile '$(SandboxOutputPath)\run.ps1' -Uri 'https://ulm-dev.zuken.com/Team-Erlangen/scripts/raw/branch/trunk/sandbox/run.ps1'&quot;" />
	</Target>

</Project>